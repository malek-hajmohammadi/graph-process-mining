{"version":3,"file":"kapsule.js","sources":["../node_modules/debounce/index.js","../src/index.js"],"sourcesContent":["/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear' \n * that is a function which will clear the timer to prevent previously scheduled executions. \n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} function to wrap\n * @param {Number} timeout in ms (`100`)\n * @param {Boolean} whether to execute at the beginning (`false`)\n * @api public\n */\nfunction debounce(func, wait, immediate){\n  var timeout, args, context, timestamp, result;\n  if (null == wait) wait = 100;\n\n  function later() {\n    var last = Date.now() - timestamp;\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last);\n    } else {\n      timeout = null;\n      if (!immediate) {\n        result = func.apply(context, args);\n        context = args = null;\n      }\n    }\n  };\n\n  var debounced = function(){\n    context = this;\n    args = arguments;\n    timestamp = Date.now();\n    var callNow = immediate && !timeout;\n    if (!timeout) timeout = setTimeout(later, wait);\n    if (callNow) {\n      result = func.apply(context, args);\n      context = args = null;\n    }\n\n    return result;\n  };\n\n  debounced.clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n  \n  debounced.flush = function() {\n    if (timeout) {\n      result = func.apply(context, args);\n      context = args = null;\n      \n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n\n  return debounced;\n};\n\n// Adds compatibility for ES modules\ndebounce.debounce = debounce;\n\nmodule.exports = debounce;\n","import debounce from 'debounce';\n\nclass Prop {\n  constructor(name, {\n    default: defaultVal = null,\n    triggerUpdate = true,\n    onChange = (newVal, state) => {}\n  }) {\n    this.name = name;\n    this.defaultVal = defaultVal;\n    this.triggerUpdate = triggerUpdate;\n    this.onChange = onChange;\n  }\n}\n\nexport default function ({\n  stateInit = (() => ({})),\n  props: rawProps = {},\n  methods = {},\n  aliases = {},\n  init: initFn = (() => {}),\n  update: updateFn = (() => {})\n}) {\n\n  // Parse props into Prop instances\n  const props = Object.keys(rawProps).map(propName =>\n    new Prop(propName, rawProps[propName])\n  );\n\n  return function(options = {}) {\n\n    // Holds component state\n    let state = Object.assign({},\n      stateInit instanceof Function ? stateInit(options) : stateInit, // Support plain objects for backwards compatibility\n      { initialised: false }\n    );\n\n    // keeps track of which props triggered an update\n    let changedProps = {};\n\n    // Component constructor\n    function comp(nodeElement) {\n      initStatic(nodeElement, options);\n      digest();\n\n      return comp;\n    }\n\n    const initStatic = function(nodeElement, options) {\n      initFn.call(comp, nodeElement, state, options);\n      state.initialised = true;\n    };\n\n    const digest = debounce(() => {\n      if (!state.initialised) { return; }\n      updateFn.call(comp, state, changedProps);\n      changedProps = {};\n    }, 1);\n\n    // Getter/setter methods\n    props.forEach(prop => {\n      comp[prop.name] = getSetProp(prop);\n\n      function getSetProp({\n        name: prop,\n        triggerUpdate: redigest = false,\n        onChange = (newVal, state) => {},\n        defaultVal = null\n      }) {\n        return function(_) {\n          const curVal = state[prop];\n          if (!arguments.length) { return curVal } // Getter mode\n\n          const val = _ === undefined ? defaultVal : _; // pick default if value passed is undefined\n          state[prop] = val;\n          onChange.call(comp, val, state, curVal);\n\n          // track changed props\n          !changedProps.hasOwnProperty(prop) && (changedProps[prop] = curVal);\n\n          if (redigest) { digest(); }\n          return comp;\n        }\n      }\n    });\n\n    // Other methods\n    Object.keys(methods).forEach(methodName => {\n      comp[methodName] = (...args) => methods[methodName].call(comp, state, ...args);\n    });\n\n    // Link aliases\n    Object.entries(aliases).forEach(([alias, target]) => comp[alias] = comp[target]);\n\n    // Reset all component props to their default value\n    comp.resetProps = function() {\n      props.forEach(prop => {\n        comp[prop.name](prop.defaultVal);\n      });\n      return comp;\n    };\n\n    //\n\n    comp.resetProps(); // Apply all prop defaults\n    state._rerender = digest; // Expose digest method\n\n    return comp;\n  }\n}\n"],"names":["Prop","name","defaultVal","triggerUpdate","onChange","newVal","state","stateInit","props","rawProps","methods","aliases","init","initFn","update","updateFn","Object","keys","map","propName","options","assign","Function","initialised","changedProps","comp","nodeElement","initStatic","digest","call","debounce","forEach","prop","getSetProp","redigest","_","curVal","arguments","length","val","undefined","hasOwnProperty","methodName","args","entries","alias","target","resetProps","_rerender"],"mappings":"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"}